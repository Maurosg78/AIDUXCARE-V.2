
> aiduxcare-v2@0.1.0 test /Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2
> vitest --config config/vitest.config.ts


 DEV  v1.6.1 /Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2

 â¯ src/core/fhir/__tests__/adapters.integration.test.ts  (0 test)
 âœ“ src/core/fhir/__tests__/validators.test.ts  (21 tests) 15ms
 âœ“ src/core/fhir/__tests__/adapters.test.ts  (20 tests) 18ms
 âœ“ __tests__/evals/AudioCaptureService.eval.test.ts  (12 tests) 17ms
stdout | __tests__/evals/AudioCaptureService.eval.test.ts > EVAL: Sistema de Escucha Activa ClÃ­nica > IntegraciÃ³n con EMR > formatea correctamente el contenido para insertarlo en el EMR
Direct function called with segments: 10
Direct function returning: ğŸ”Š **Resumen de consulta (transcripciÃ³n asistida)*...

stdout | __tests__/evals/AudioCaptureService.eval.test.ts > EVAL: Sistema de Escucha Activa ClÃ­nica > IntegraciÃ³n con EMR > inserta correctamente el contenido aprobado en el EMR
Direct function called with segments: 10
Direct function returning: ğŸ”Š **Resumen de consulta (transcripciÃ³n asistida)*...

stdout | __tests__/evals/AudioCaptureService.eval.test.ts > EVAL: Sistema de Escucha Activa ClÃ­nica > debe manejar correctamente la transcripciÃ³n de mÃºltiples oradores
MultiSpeakerTranscript: 10
Direct function called with segments: 10
Direct function returning: ğŸ”Š **Resumen de consulta (transcripciÃ³n asistida)*...
Result: ğŸ”Š **Resumen de consulta (transcripciÃ³n asistida)**

**Profesional sanitario:**
- Buenos dÃ­as, soy el Dr. MartÃ­nez. Â¿CÃ³mo se encuentra hoy?
- Â¿Puede describirme cÃ³mo es ese dolor? Â¿Es constante o aparece con ciertos movimientos?
- Â¿Ha notado inflamaciÃ³n en la rodilla? Â¿O algÃºn sonido al mover la articulaciÃ³n?
- Vamos a examinar la rodilla y solicitar algunas pruebas diagnÃ³sticas para determinar la causa exacta.
- Es posible. DespuÃ©s de ver los resultados, evaluaremos si necesita fisioterapia o si hay que considerar otras opciones de tratamiento.

**Paciente:**
- Buenos dÃ­as doctor. Vengo por el dolor en la rodilla derecha que llevo sintiendo varias semanas.
- Es mÃ¡s fuerte cuando subo escaleras o me levanto despuÃ©s de estar sentado mucho tiempo.
- SÃ­, a veces se me hincha, sobre todo al final del dÃ­a. Y siento como si crujiera cuando la doblo.

**AcompaÃ±ante:**
- TambiÃ©n le duele por las noches. A veces se despierta por el dolor y tiene que tomar analgÃ©sicos.
- Doctor, Â¿cree que podrÃ­a necesitar fisioterapia? Ya tuvo problemas similares hace unos aÃ±os.


stdout | __tests__/evals/AudioCaptureService.eval.test.ts > EVAL: Sistema de Escucha Activa ClÃ­nica > debe manejar correctamente la transcripciÃ³n con errores
ErrorTranscript: 10
Direct function called with segments: 10
Direct function returning: ğŸ”Š **Resumen de consulta (transcripciÃ³n asistida)*...
Result for errors: ğŸ”Š **Resumen de consulta (transcripciÃ³n asistida)**

**Profesional sanitario:**
- Buenos dÃ­as, vamos a revisar sus resultados de laboratorio.
- He notado que sus niveles de glucosa estÃ¡n un poco elevados. Â¿Ha modificado su dieta recientemente?
- Entiendo. Vamos a ajustar su medicaciÃ³n y establecer un plan de seguimiento mÃ¡s riguroso.
- ...frecuencia... intensidad...

**Paciente:**
- Gracias doctor. Estaba preocupado por... (inaudible)
- (ruido de fondo) ...sido difÃ­cil mantener... durante las fiestas...
- Doctor, tambiÃ©n querÃ­a preguntarle sobre estos dolores de cabeza que...
- Casi todos los dÃ­as, especialmente por la tarde.

**AcompaÃ±ante:**
- (inaudible) ...
- Y ha estado tomando analgÃ©sicos sin receta, pero no le hacen mucho efecto.


stdout | __tests__/evals/AudioCaptureService.eval.test.ts > EVAL: Sistema de Escucha Activa ClÃ­nica > debe manejar correctamente la transcripciÃ³n vacÃ­a
EmptyTranscript: 0
Direct function called with segments: 0
Result for empty: ğŸ”Š **Resumen de consulta (transcripciÃ³n asistida - sin datos)**

 âœ“ src/core/fhir/tests/utils.test.ts  (33 tests) 21ms
 â¯ node_modules.rescue.1758834503/@bcoe/v8-coverage/src/test/merge.spec.ts  (0 test)
 â¯ src/core/fhir/__tests__/contracts.public-api.test.ts  (0 test)
 â¯ src/core/assistant/__tests__/extractEntities.spec.ts  (17 tests | 7 failed) 37ms
   â¯ src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer medicamentos correctamente
     â†’ expected undefined to be 7 // Object.is equality
   â¯ src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer diagnÃ³sticos neurolÃ³gicos
     â†’ expected [ { kind: 'diagnosis', â€¦(2) } ] to have a length of 2 but got 1
   â¯ src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer procedimientos de evaluaciÃ³n
     â†’ expected [ { kind: 'procedure', â€¦(2) } ] to have a length of 2 but got 1
   â¯ src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer tÃ©cnicas de fisioterapia
     â†’ expected [ { kind: 'procedure', â€¦(2) } ] to have a length of 2 but got 1
   â¯ src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer precauciones
     â†’ expected 'Evitar movimientos bruscos y precauciâ€¦' to be 'Evitar movimientos bruscos' // Object.is equality
   â¯ src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer entidades mixtas correctamente
     â†’ expected false to be true // Object.is equality
   â¯ src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > validateExtractedEntities > debe calcular calidad promedio correctamente
     â†’ expected 0.8000000000000002 to be 0.8 // Object.is equality
 âœ“ src/core/fhir/__tests__/fhirTypes.test.ts  (10 tests) 19ms
 â¯ src/core/assistant/__tests__/rails.spec.ts  (22 tests | 5 failed) 55ms
   â¯ src/core/assistant/__tests__/rails.spec.ts > RAILS System > validateClinicalQuery > debe rechazar consultas genÃ©ricas
     â†’ expected true to be false // Object.is equality
   â¯ src/core/assistant/__tests__/rails.spec.ts > RAILS System > getClinicalConfidence > debe asignar confianza media para consultas generales
     â†’ expected 0.85 to be less than 0.8
   â¯ src/core/assistant/__tests__/rails.spec.ts > RAILS System > getClinicalConfidence > debe incrementar confianza por palabras clave tÃ©cnicas
     â†’ expected 0.85 to be greater than 0.9
   â¯ src/core/assistant/__tests__/rails.spec.ts > RAILS System > getClinicalConfidence > debe manejar consultas mixtas correctamente
     â†’ expected 1 to be less than 0.9
   â¯ src/core/assistant/__tests__/rails.spec.ts > RAILS System > IntegraciÃ³n RAILS > debe rechazar consulta no mÃ©dica completamente
     â†’ expected 0.5 to be less than 0.5
 â¯ src/core/emr/__tests__/medications.spec.ts  (9 tests | 9 failed) 29ms
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > addMedicationToVisit > debe agregar medicamento a la visita correctamente
     â†’ addMedicationToVisit is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > addMedicationToVisit > debe manejar medicamentos sin campos opcionales
     â†’ addMedicationToVisit is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > addMedicationToVisit > debe manejar errores de Firestore
     â†’ addMedicationToVisit is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe formatear medicamento completo correctamente
     â†’ formatSoapFromMedication is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe formatear medicamento bÃ¡sico correctamente
     â†’ formatSoapFromMedication is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe incluir instrucciones de administraciÃ³n
     â†’ formatSoapFromMedication is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe manejar medicamentos con instrucciones personalizadas
     â†’ formatSoapFromMedication is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > IntegraciÃ³n completa > debe agregar medicamento y generar SOAP correctamente
     â†’ addMedicationToVisit is not a function
   â¯ src/core/emr/__tests__/medications.spec.ts > MedicationService > IntegraciÃ³n completa > debe manejar flujo completo con errores
     â†’ addMedicationToVisit is not a function
 â¯ src/__tests__/auth-flow.integration.test.tsx  (0 test)
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-types.test.ts  (0 test)
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-types.test.ts  (0 test)
 â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts  (11 tests | 5 failed) 33ms
   â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > routeQuery > debe detectar consultas mixtas (datos + conocimiento)
     â†’ expected 0.9 to be 0.7 // Object.is equality
   â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar consultas de datos correctamente
     â†’ expected undefined to deeply equal { age: 35 }
   â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar consultas LLM correctamente
     â†’ expected undefined to deeply equal [ { kind: 'exercise', â€¦(1) } ]
   â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar consultas mixtas correctamente
     â†’ expected 'La edad del paciente es 35 aÃ±os\n\nLaâ€¦' to contain 'Para su edad, recomiendo ejercicios dâ€¦'
   â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar errores correctamente
     â†’ expected true to be false // Object.is equality
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-types.test.ts  (0 test)
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-types.test.ts  (0 test)
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-custom-expect-types.test.ts  (0 test)
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-custom-expect-types.test.ts  (0 test)
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-custom-expect-types.test.ts  (0 test)
 â¯ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-custom-expect-types.test.ts  (0 test)
 â¯ src/core/fhir/__tests__/snapshots/patient.snapshot.test.ts  (1 test | 1 failed) 12ms
   â¯ src/core/fhir/__tests__/snapshots/patient.snapshot.test.ts > FHIR Patient snapshot > matches expected snapshot for a representative internal patient
     â†’ scrubFhirResource is not a function
 â¯ src/core/fhir/__tests__/snapshots/encounter.snapshot.test.ts  (1 test | 1 failed) 10ms
   â¯ src/core/fhir/__tests__/snapshots/encounter.snapshot.test.ts > FHIR Encounter snapshot > matches expected snapshot for an ambulatory encounter
     â†’ scrubFhirResource is not a function
 âœ“ src/tests/basic.test.ts  (5 tests) 7ms
 âœ“ src/utils/cleanVertexResponse.test.ts  (2 tests) 14ms
 âœ“ __tests__/minimal.test.ts  (3 tests) 5ms
 â†“ test/firebase.alias.real.test.ts  (1 test | 1 skipped)
 âœ“ test/firebase.alias.test.ts  (1 test) 3ms
 âœ“ test/sanity.test.ts  (1 test) 4ms
 âœ“ test/WelcomePage.test.tsx  (1 test) 3ms
 âœ“ test/Router.smoke.test.tsx  (1 test) 3ms

â¯â¯â¯â¯â¯â¯ Failed Suites 12 â¯â¯â¯â¯â¯â¯

 FAIL  src/__tests__/auth-flow.integration.test.tsx [ src/__tests__/auth-flow.integration.test.tsx ]
Error: Transform failed with 1 error:
/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/src/pages/VerifyEmailPage.tsx:121:1: ERROR: Syntax error "n"
 â¯ failureErrorWithLog node_modules/.pnpm/esbuild@0.21.5/node_modules/esbuild/lib/main.js:1472:15
 â¯ node_modules/.pnpm/esbuild@0.21.5/node_modules/esbuild/lib/main.js:755:50
 â¯ responseCallbacks.<computed> node_modules/.pnpm/esbuild@0.21.5/node_modules/esbuild/lib/main.js:622:9
 â¯ handleIncomingPacket node_modules/.pnpm/esbuild@0.21.5/node_modules/esbuild/lib/main.js:677:12
 â¯ Socket.readFromStdout node_modules/.pnpm/esbuild@0.21.5/node_modules/esbuild/lib/main.js:600:7
 â¯ Socket.emit node:events:524:28

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/40]â¯

 FAIL  src/core/fhir/__tests__/adapters.integration.test.ts [ src/core/fhir/__tests__/adapters.integration.test.ts ]
Error: Failed to resolve import "./validators" from "src/core/fhir/public-api.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/40]â¯

 FAIL  src/core/fhir/__tests__/contracts.public-api.test.ts [ src/core/fhir/__tests__/contracts.public-api.test.ts ]
Error: Failed to resolve import "./validators" from "src/core/fhir/public-api.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/40]â¯

 FAIL  node_modules.rescue.1758834503/@bcoe/v8-coverage/src/test/merge.spec.ts [ node_modules.rescue.1758834503/@bcoe/v8-coverage/src/test/merge.spec.ts ]
Error: Failed to resolve import "chai" from "node_modules.rescue.1758834503/@bcoe/v8-coverage/src/test/merge.spec.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-custom-expect-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-custom-expect-types.test.ts ]
Error: Failed to resolve import "bun:test" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-custom-expect-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-types.test.ts ]
Error: Failed to resolve import "bun:test" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/bun/bun-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-custom-expect-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-custom-expect-types.test.ts ]
Error: Failed to resolve import "../../matchers" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-custom-expect-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-types.test.ts ]
Error: Failed to resolve import "../../jest" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest/jest-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-custom-expect-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-custom-expect-types.test.ts ]
Error: Failed to resolve import "@jest/globals" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-custom-expect-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-types.test.ts ]
Error: Failed to resolve import "@jest/globals" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/jest-globals/jest-globals-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-custom-expect-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-custom-expect-types.test.ts ]
Error: Failed to resolve import "../../matchers" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-custom-expect-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/40]â¯

 FAIL  node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-types.test.ts [ node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-types.test.ts ]
Error: Failed to resolve import "../../vitest" from "node_modules.rescue.1758834503/@testing-library/jest-dom/types/__tests__/vitest/vitest-types.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49258:41
 â¯ TransformPluginContext.error node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49253:16
 â¯ normalizeUrl node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64306:23
 â¯ async file:/Users/mauriciosobarzo/Desktop/AIDUXCARE-V.2/node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64438:39
 â¯ TransformPluginContext.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:64365:7
 â¯ PluginContainer.transform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:49099:18
 â¯ loadAndTransform node_modules/.pnpm/vite@5.4.20_@types+node@20.19.17/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:51977:27

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/40]â¯

â¯â¯â¯â¯â¯â¯ Failed Tests 28 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > routeQuery > debe detectar consultas mixtas (datos + conocimiento)
AssertionError: expected 0.9 to be 0.7 // Object.is equality

- Expected
+ Received

- 0.7
+ 0.9

 â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts:67:33
     65|       
     66|       expect(result.type).toBe('both');
     67|       expect(result.confidence).toBe(0.7);
       |                                 ^
     68|     });
     69| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/40]â¯

 FAIL  src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar consultas de datos correctamente
AssertionError: expected undefined to deeply equal { age: 35 }

- Expected: 
Object {
  "age": 35,
}

+ Received: 
undefined

 â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts:102:27
    100|       expect(result.routeType).toBe('data');
    101|       expect(result.answerMarkdown).toBe('La edad del paciente es 35 aâ€¦
    102|       expect(result.data).toEqual({ age: 35 });
       |                           ^
    103|       expect(result.confidence).toBe(0.95);
    104|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/40]â¯

 FAIL  src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar consultas LLM correctamente
AssertionError: expected undefined to deeply equal [ { kind: 'exercise', â€¦(1) } ]

- Expected: 
Array [
  Object {
    "kind": "exercise",
    "name": "estabilizaciÃ³n lumbar",
  },
]

+ Received: 
undefined

 â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts:121:31
    119|       expect(result.routeType).toBe('llm');
    120|       expect(result.answerMarkdown).toBe('Para el dolor lumbar, recomiâ€¦
    121|       expect(result.entities).toEqual([{ kind: 'exercise', name: 'estaâ€¦
       |                               ^
    122|       expect(result.confidence).toBe(0.8);
    123|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/40]â¯

 FAIL  src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar consultas mixtas correctamente
AssertionError: expected 'La edad del paciente es 35 aÃ±os\n\nLaâ€¦' to contain 'Para su edad, recomiendo ejercicios dâ€¦'

- Expected
+ Received

- Para su edad, recomiendo ejercicios de bajo impacto
+ La edad del paciente es 35 aÃ±os
+
+ La edad del paciente es 45 aÃ±os

 â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts:150:37
    148|       expect(result.routeType).toBe('both');
    149|       expect(result.answerMarkdown).toContain('La edad del paciente esâ€¦
    150|       expect(result.answerMarkdown).toContain('Para su edad, recomiendâ€¦
       |                                     ^
    151|       expect(result.confidence).toBe(0.7);
    152|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/40]â¯

 FAIL  src/core/assistant/__tests__/assistantAdapter.spec.ts > AssistantAdapter > runAssistantQuery > debe manejar errores correctamente
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ src/core/assistant/__tests__/assistantAdapter.spec.ts:161:25
    159|       });
    160| 
    161|       expect(result.ok).toBe(false);
       |                         ^
    162|       expect(result.error).toBe('Error de red');
    163|       expect(result.confidence).toBe(0);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/40]â¯

 FAIL  src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer medicamentos correctamente
AssertionError: expected undefined to be 7 // Object.is equality

- Expected: 
7

+ Received: 
undefined

 â¯ src/core/assistant/__tests__/extractEntities.spec.ts:19:32
     17|       expect(med.strength).toBe('400 mg');
     18|       expect(med.frequency).toBe('cada 8 horas');
     19|       expect(med.durationDays).toBe(7);
       |                                ^
     20|       expect(med.confidence).toBe(0.9);
     21|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/40]â¯

 FAIL  src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer diagnÃ³sticos neurolÃ³gicos
AssertionError: expected [ { kind: 'diagnosis', â€¦(2) } ] to have a length of 2 but got 1

- Expected
+ Received

- 2
+ 1

 â¯ src/core/assistant/__tests__/extractEntities.spec.ts:58:24
     56|       const entities = extractEntities(input);
     57|       
     58|       expect(entities).toHaveLength(2);
       |                        ^
     59|       expect(entities.every(e => e.kind === 'diagnosis')).toBe(true);
     60|       

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/40]â¯

 FAIL  src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer procedimientos de evaluaciÃ³n
AssertionError: expected [ { kind: 'procedure', â€¦(2) } ] to have a length of 2 but got 1

- Expected
+ Received

- 2
+ 1

 â¯ src/core/assistant/__tests__/extractEntities.spec.ts:72:24
     70|       const entities = extractEntities(input);
     71|       
     72|       expect(entities).toHaveLength(2);
       |                        ^
     73|       expect(entities.every(e => e.kind === 'procedure')).toBe(true);
     74|       

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/40]â¯

 FAIL  src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer tÃ©cnicas de fisioterapia
AssertionError: expected [ { kind: 'procedure', â€¦(2) } ] to have a length of 2 but got 1

- Expected
+ Received

- 2
+ 1

 â¯ src/core/assistant/__tests__/extractEntities.spec.ts:87:24
     85|       const entities = extractEntities(input);
     86|       
     87|       expect(entities).toHaveLength(2);
       |                        ^
     88|       expect(entities.every(e => e.kind === 'procedure')).toBe(true);
     89|       

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[21/40]â¯

 FAIL  src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer precauciones
AssertionError: expected 'Evitar movimientos bruscos y precauciâ€¦' to be 'Evitar movimientos bruscos' // Object.is equality

- Expected
+ Received

- Evitar movimientos bruscos
+ Evitar movimientos bruscos y precauciÃ³n con el dolor

 â¯ src/core/assistant/__tests__/extractEntities.spec.ts:119:26
    117|       const inst2 = entities[1] as InstructionEntity;
    118|       
    119|       expect(inst1.text).toBe('Evitar movimientos bruscos');
       |                          ^
    120|       expect(inst2.text).toBe('precauciÃ³n con el dolor');
    121|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22/40]â¯

 FAIL  src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > extractEntities > debe extraer entidades mixtas correctamente
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ src/core/assistant/__tests__/extractEntities.spec.ts:142:28
    140|       expect(hasDiagnosis).toBe(true);
    141|       expect(hasMedication).toBe(true);
    142|       expect(hasProcedure).toBe(true);
       |                            ^
    143|     });
    144|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[23/40]â¯

 FAIL  src/core/assistant/__tests__/extractEntities.spec.ts > ExtractEntities System > validateExtractedEntities > debe calcular calidad promedio correctamente
AssertionError: expected 0.8000000000000002 to be 0.8 // Object.is equality

- Expected
+ Received

- 0.8
+ 0.8000000000000002

 â¯ src/core/assistant/__tests__/extractEntities.spec.ts:251:35
    249|       
    250|       expect(result.validEntities).toHaveLength(3);
    251|       expect(result.qualityScore).toBe(0.8); // (0.8 + 0.9 + 0.7) / 3
       |                                   ^
    252|     });
    253| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[24/40]â¯

 FAIL  src/core/assistant/__tests__/rails.spec.ts > RAILS System > validateClinicalQuery > debe rechazar consultas genÃ©ricas
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ src/core/assistant/__tests__/rails.spec.ts:99:30
     97|       const result = validateClinicalQuery(input);
     98|       
     99|       expect(result.isValid).toBe(false);
       |                              ^
    100|       expect(result.reason).toBe('Consulta demasiado genÃ©rica. Por favâ€¦
    101|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[25/40]â¯

 FAIL  src/core/assistant/__tests__/rails.spec.ts > RAILS System > getClinicalConfidence > debe asignar confianza media para consultas generales
AssertionError: expected 0.85 to be less than 0.8
 â¯ src/core/assistant/__tests__/rails.spec.ts:132:26
    130|       
    131|       expect(confidence).toBeGreaterThan(0.5);
    132|       expect(confidence).toBeLessThan(0.8);
       |                          ^
    133|     });
    134| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[26/40]â¯

 FAIL  src/core/assistant/__tests__/rails.spec.ts > RAILS System > getClinicalConfidence > debe incrementar confianza por palabras clave tÃ©cnicas
AssertionError: expected 0.85 to be greater than 0.9
 â¯ src/core/assistant/__tests__/rails.spec.ts:146:26
    144|       const confidence = getClinicalConfidence(input);
    145|       
    146|       expect(confidence).toBeGreaterThan(0.9);
       |                          ^
    147|     });
    148| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[27/40]â¯

 FAIL  src/core/assistant/__tests__/rails.spec.ts > RAILS System > getClinicalConfidence > debe manejar consultas mixtas correctamente
AssertionError: expected 1 to be less than 0.9
 â¯ src/core/assistant/__tests__/rails.spec.ts:154:26
    152|       
    153|       expect(confidence).toBeGreaterThan(0.6);
    154|       expect(confidence).toBeLessThan(0.9);
       |                          ^
    155|     });
    156|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[28/40]â¯

 FAIL  src/core/assistant/__tests__/rails.spec.ts > RAILS System > IntegraciÃ³n RAILS > debe rechazar consulta no mÃ©dica completamente
AssertionError: expected 0.5 to be less than 0.5
 â¯ src/core/assistant/__tests__/rails.spec.ts:188:26
    186|       // 3. Confianza
    187|       const confidence = getClinicalConfidence(input);
    188|       expect(confidence).toBeLessThan(0.5);
       |                          ^
    189|     });
    190|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[29/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > addMedicationToVisit > debe agregar medicamento a la visita correctamente
TypeError: addMedicationToVisit is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:42:28
     40|       vi.mocked(addDoc).mockResolvedValue(mockDocRef);
     41| 
     42|       const result = await addMedicationToVisit('visit-123', mockMedicâ€¦
       |                            ^
     43| 
     44|       expect(vi.mocked(addDoc)).toHaveBeenCalledWith(

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[30/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > addMedicationToVisit > debe manejar medicamentos sin campos opcionales
TypeError: addMedicationToVisit is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:69:28
     67|       vi.mocked(addDoc).mockResolvedValue(mockDocRef);
     68| 
     69|       const result = await addMedicationToVisit('visit-789', mockMedicâ€¦
       |                            ^
     70| 
     71|       expect(vi.mocked(addDoc)).toHaveBeenCalledWith(

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[31/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > addMedicationToVisit > debe manejar errores de Firestore
TypeError: addMedicationToVisit is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:92:20
     90|       vi.mocked(addDoc).mockRejectedValue(new Error('Error de Firestorâ€¦
     91| 
     92|       await expect(addMedicationToVisit('visit-error', mockMedication))
       |                    ^
     93|         .rejects.toThrow('Error de Firestore');
     94|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[32/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe formatear medicamento completo correctamente
TypeError: formatSoapFromMedication is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:108:22
    106|       };
    107| 
    108|       const result = formatSoapFromMedication(mockMedication);
       |                      ^
    109| 
    110|       expect(result).toContain('**MedicaciÃ³n:** ibuprofeno');

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[33/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe formatear medicamento bÃ¡sico correctamente
TypeError: formatSoapFromMedication is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:123:22
    121|       };
    122| 
    123|       const result = formatSoapFromMedication(mockMedication);
       |                      ^
    124| 
    125|       expect(result).toContain('**MedicaciÃ³n:** paracetamol');

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[34/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe incluir instrucciones de administraciÃ³n
TypeError: formatSoapFromMedication is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:142:22
    140|       };
    141| 
    142|       const result = formatSoapFromMedication(mockMedication);
       |                      ^
    143| 
    144|       expect(result).toContain('**Instrucciones:** Administrar con aliâ€¦

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[35/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > formatSoapFromMedication > debe manejar medicamentos con instrucciones personalizadas
TypeError: formatSoapFromMedication is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:157:22
    155|       };
    156| 
    157|       const result = formatSoapFromMedication(mockMedication);
       |                      ^
    158| 
    159|       expect(result).toContain('**Instrucciones:** Solo en caso de dolâ€¦

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[36/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > IntegraciÃ³n completa > debe agregar medicamento y generar SOAP correctamente
TypeError: addMedicationToVisit is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:178:34
    176|       vi.mocked(addDoc).mockResolvedValue(mockDocRef);
    177| 
    178|       const medicationId = await addMedicationToVisit('visit-integratiâ€¦
       |                                  ^
    179|       expect(medicationId).toBe('med-789');
    180| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[37/40]â¯

 FAIL  src/core/emr/__tests__/medications.spec.ts > MedicationService > IntegraciÃ³n completa > debe manejar flujo completo con errores
TypeError: addMedicationToVisit is not a function
 â¯ src/core/emr/__tests__/medications.spec.ts:212:20
    210|       vi.mocked(addDoc).mockRejectedValue(new Error('Error de Firestorâ€¦
    211| 
    212|       await expect(addMedicationToVisit('visit-error', mockMedication))
       |                    ^
    213|         .rejects.toThrow('Error de Firestore');
    214| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[38/40]â¯

 FAIL  src/core/fhir/__tests__/snapshots/encounter.snapshot.test.ts > FHIR Encounter snapshot > matches expected snapshot for an ambulatory encounter
TypeError: scrubFhirResource is not a function
 â¯ src/core/fhir/__tests__/snapshots/encounter.snapshot.test.ts:29:31
     27|     
     28|     // Limpiar campos dinÃ¡micos antes del snapshot
     29|     const scrubbedEncounter = scrubFhirResource(fhirEncounter);
       |                               ^
     30|     expect(scrubbedEncounter).toMatchSnapshot();
     31|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[39/40]â¯

 FAIL  src/core/fhir/__tests__/snapshots/patient.snapshot.test.ts > FHIR Patient snapshot > matches expected snapshot for a representative internal patient
TypeError: scrubFhirResource is not a function
 â¯ src/core/fhir/__tests__/snapshots/patient.snapshot.test.ts:37:29
     35|     
     36|     // Limpiar campos dinÃ¡micos antes del snapshot
     37|     const scrubbedPatient = scrubFhirResource(fhirPatient);
       |                             ^
     38|     expect(scrubbedPatient).toMatchSnapshot();
     39|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[40/40]â¯

 Test Files  18 failed | 12 passed | 1 skipped (31)
      Tests  28 failed | 143 passed | 1 skipped (172)
   Start at  14:41:35
   Duration  9.78s (transform 1.12s, setup 204ms, collect 1.30s, tests 305ms, environment 22.72s, prepare 4.76s)


 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
Cancelling test run. Press CTRL+c again to exit forcefully.

â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
