
echo "🧪 CI Gate (pre-push): typecheck, lint, tests y build (prod)"

# 1) TypeScript
npm run -s typecheck || { echo "❌ TypeScript con errores"; exit 1; }

# 2) ESLint
npm run -s lint || { echo "❌ ESLint con errores"; exit 1; }

# 3) Tests (Vitest): exigir al menos un test
if [ -f "vitest.config.ts" ] || [ -f "vitest.config.js" ] || ls test 1>/dev/null 2>&1 || ls src/**/*.test.* 1>/dev/null 2>&1; then
  npm run -s test:ci || { echo "❌ Tests fallando"; exit 1; }
else
  echo "❌ No se detectaron tests. Agrega al menos uno (p.ej., wizard) antes de push."
  exit 1
fi

# 4) Build de producción (Vite)
npm run -s build || { echo "❌ Build de producción falló"; exit 1; }

echo "✅ pre-push OK"
