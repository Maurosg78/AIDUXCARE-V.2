
echo "ğŸ§ª CI Gate (pre-push): typecheck, lint, tests y build (prod)"

# 1) TypeScript
npm run -s typecheck || { echo "âŒ TypeScript con errores"; exit 1; }

# 2) ESLint
npm run -s lint || { echo "âŒ ESLint con errores"; exit 1; }

# 3) Tests (Vitest): exigir al menos un test
if [ -f "vitest.config.ts" ] || [ -f "vitest.config.js" ] || ls test 1>/dev/null 2>&1 || ls src/**/*.test.* 1>/dev/null 2>&1; then
  npm run -s test:ci || { echo "âŒ Tests fallando"; exit 1; }
else
  echo "âŒ No se detectaron tests. Agrega al menos uno (p.ej., wizard) antes de push."
  exit 1
fi

# 4) Build de producciÃ³n (Vite)
npm run -s build || { echo "âŒ Build de producciÃ³n fallÃ³"; exit 1; }

echo "âœ… pre-push OK"
