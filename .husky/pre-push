#!/usr/bin/env sh
set -e

# Detectar cambios a empujar (solo nombres de archivos)
CHANGED="$(git diff --name-only --cached || true)"

# Si SOLO hay cambios en docs/adr/** o .gitignore, saltar chequeos pesados
echo "$CHANGED" | grep -vE '^(docs/adr/|\.gitignore$)' >/dev/null 2>&1 && RUN_CHECKS=1 || RUN_CHECKS=0

if [ "$RUN_CHECKS" -eq 0 ]; then
  echo "🛈 Pre-push: solo meta/ADR/.gitignore — se omiten TS/Lint."
  exit 0
fi

echo "🔎 Pre-push: ejecutando TypeScript y Lint…"
# Ajusta estos comandos a tus scripts reales si existen en package.json
# Si no tienes scripts, ejecuta las herramientas directamente.
if npm run -s typecheck >/dev/null 2>&1; then
  echo "✅ TypeScript OK"
else
  echo "❌ TypeScript con errores"; exit 1
fi

if npm run -s lint >/dev/null 2>&1; then
  echo "✅ Lint OK"
else
  echo "❌ Lint con errores"; exit 1
fi
