<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="720" font-family="Inter,Arial,sans-serif">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 z" fill="#333"/>
    </marker>
    <style>
      .box{fill:#fff;stroke:#333;stroke-width:2;rx:10;ry:10}
      .title{font-size:18px;font-weight:700;fill:#111}
      .meta{font-size:12px;fill:#444}
      .edge{stroke:#333;stroke-width:2;marker-end:url(#arrow)}
      .label{font-size:12px;fill:#111}
      .swim{fill:#f6f7f9;stroke:#ddd}
    </style>
  </defs>

  <!-- Swimlanes -->
  <rect class="swim" x="20" y="40" width="1160" height="300"/>
  <text class="meta" x="30" y="60">Transcription Path (Whisper)</text>

  <rect class="swim" x="20" y="380" width="1160" height="280"/>
  <text class="meta" x="30" y="400">Generation, Evals & Persistence</text>

  <!-- Transcription path -->
  <rect class="box" x="60" y="120" width="210" height="90"/>
  <text class="title" x="165" y="150" text-anchor="middle">Upload Audio</text>
  <text class="meta"  x="165" y="170" text-anchor="middle">wav/mp3 · 16kHz mono</text>

  <rect class="box" x="310" y="120" width="210" height="90"/>
  <text class="title" x="415" y="150" text-anchor="middle">Pre-process</text>
  <text class="meta"  x="415" y="170" text-anchor="middle">normalize · VAD · diarize</text>

  <rect class="box" x="560" y="120" width="210" height="90"/>
  <text class="title" x="665" y="150" text-anchor="middle">Chunking</text>
  <text class="meta"  x="665" y="170" text-anchor="middle">&lt;=60s · 250ms overlap</text>

  <rect class="box" x="810" y="120" width="210" height="90"/>
  <text class="title" x="915" y="150" text-anchor="middle">Whisper Inference</text>
  <text class="meta"  x="915" y="170" text-anchor="middle">large-v3 · timestamps</text>

  <line class="edge" x1="270" y1="165" x2="310" y2="165"/>
  <line class="edge" x1="520" y1="165" x2="560" y2="165"/>
  <line class="edge" x1="770" y1="165" x2="810" y2="165"/>

  <rect class="box" x="1060" y="120" width="100" height="90"/>
  <text class="title" x="1110" y="150" text-anchor="middle">QC</text>
  <text class="meta"  x="1110" y="170" text-anchor="middle">conf · OOV · SNR</text>

  <line class="edge" x1="1020" y1="165" x2="1060" y2="165"/>
  <text class="label" x="1040" y="150">quality</text>

  <!-- Output of transcription -->
  <rect class="box" x="870" y="240" width="290" height="70"/>
  <text class="meta" x="1015" y="262" text-anchor="middle">Transcript + timestamps + metrics</text>

  <line class="edge" x1="1110" y1="210" x2="1110" y2="240"/>

  <!-- Generation & evals path -->
  <rect class="box" x="60" y="460" width="240" height="100"/>
  <text class="title" x="180" y="490" text-anchor="middle">Prompt (Vertex AI)</text>
  <text class="meta"  x="180" y="510" text-anchor="middle">SOAP JSON · en-CA</text>
  <text class="meta"  x="180" y="528" text-anchor="middle">promptId@semver</text>

  <rect class="box" x="340" y="460" width="240" height="100"/>
  <text class="title" x="460" y="490" text-anchor="middle">Generate</text>
  <text class="meta"  x="460" y="510" text-anchor="middle">model=gemini/llm</text>
  <text class="meta"  x="460" y="528" text-anchor="middle">guardrails</text>

  <rect class="box" x="620" y="460" width="220" height="100"/>
  <text class="title" x="730" y="490" text-anchor="middle">Langfuse Evals</text>
  <text class="meta"  x="730" y="510" text-anchor="middle">structure · factuality</text>
  <text class="meta"  x="730" y="528" text-anchor="middle">toxicity · coverage</text>

  <rect class="box" x="880" y="460" width="260" height="100"/>
  <text class="title" x="1010" y="490" text-anchor="middle">Persist</text>
  <text class="meta"  x="1010" y="510" text-anchor="middle">notes/{encounter}/{v}</text>
  <text class="meta"  x="1010" y="528" text-anchor="middle">traceId · qualityScores</text>

  <!-- Edges lower lane -->
  <line class="edge" x1="1015" y1="310" x2="180" y2="460"/>
  <text class="label" x="300" y="405">transcript → prompt</text>

  <line class="edge" x1="300" y1="510" x2="340" y2="510"/>
  <line class="edge" x1="580" y1="510" x2="620" y2="510"/>
  <line class="edge" x1="840" y1="510" x2="880" y2="510"/>

  <!-- Global guardrails -->
  <text class="label" x="600" y="690" text-anchor="middle">PHI minimization · No new facts · RBAC/RLS · Audit trace (Langfuse)</text>
</svg>
